# 自動お問い合わせ送信ツール（Sales Bot）

大量のWebサイトに対して自動的に問い合わせフォームを探索・入力・送信し、営業活動を劇的に効率化するChrome拡張機能です。

## ✨ システム概要

このツールは、営業担当者が手動で行っていた問い合わせフォームへの入力・送信作業を完全自動化します。URLリストを読み込むだけで、以下の処理を自動実行します：

1. **自動フォーム探索** - Webページ上のtextareaやコンタクトリンクを検出
2. **インテリジェント入力** - プロファイル設定に基づいてフォームを自動入力
3. **送信確認処理** - 確認ページでの最終送信まで自動化
4. **結果追跡** - 成功・失敗・重複を詳細に記録・分析

## 🚀 主要機能

### 🔍 高度な自動探索機能
- **スマートフォーム検出**: textarea、input、select要素の自動識別
- **iframe対応**: クロスドメインiframe内のフォームも探索
- **コンタクトリンク追跡**: 問い合わせページへの自動遷移
- **除外ドメイン機能**: 特定ドメインの自動スキップ

### 🎯 インテリジェント送信システム
- **バッチ処理**: 100件ずつの効率的な処理（サーバー負荷軽減）
- **自動間隔調整**: 30秒間隔でのバッチ実行
- **重複送信防止**: 既送信先の自動スキップ機能
- **reCAPTCHA対応**: 最大40秒の待機処理

### 📊 プロファイル・データ管理
- **複数プロファイル**: 異なる営業パターンの保存・切替
- **動的パラメータ**: `[param1]`〜`[param5]`による柔軟なメッセージ生成
- **タグ機能**: URL毎の個別設定対応
- **テンプレート管理**: 会社情報、連絡先、メッセージの一元管理

### 🕒 スケジュール・制限機能
- **時間制限**: 指定時間帯での自動送信制限
- **曜日制限**: 特定曜日の送信禁止設定
- **処理監視**: リアルタイム進捗表示・停止機能
- **履歴管理**: 詳細な送信結果と統計情報

### 🔐 認証・セキュリティ
- **Supabase認証**: 安全なユーザー管理システム
- **デバイス制限**: 最大5台までのアクセス制御
- **ライセンス管理**: 有効性チェック機能
- **データ暗号化**: 機密情報の安全な保存

## 📦 システム要件

- **Google Chrome 最新版** (Manifest V3対応)
- **Chrome拡張機能の開発者モード** を有効化
- **Supabase プロジェクト** (認証・ライセンス管理用)
- **インターネット接続** (認証・同期用)

## 🏗️ システム構成

```
Sales_Bot/salesbot/
├── manifest.json         # Chrome拡張機能設定
├── background.js         # メイン処理エンジン・バッチ制御
├── main.html            # ダッシュボード画面
├── main.js              # UI制御・データ管理
├── login.js             # 認証・ライセンス管理
├── 
├── explore.js           # 🔍 フォーム・リンク探索
├── send.js              # 📤 自動入力・送信
├── confirm.js           # ✅ 送信確認処理
├── recheck.js           # 🤖 reCAPTCHA検出
├── 
├── exdb.js              # 📊 IndexedDB管理
├── process.js           # 📈 進捗監視
├── done.js              # 🎯 完了画面処理
├── 
├── styles.css           # UI デザイン
└── supabase/            # 認証ライブラリ
    └── supabase.js
```

## 🛠️ インストール手順

### 1. プロジェクトの取得
```bash
git clone https://github.com/yourname/sales-bot.git
cd sales-bot/salesbot
```

### 2. Supabase設定
以下のファイルでSupabase設定を更新：
- `background.js` (2-5行目)
- `login.js` (7-10行目)

```javascript
const supabaseConfig = {
    url: 'https://YOUR_PROJECT.supabase.co',
    anonKey: 'YOUR_ANON_KEY'
};
```

### 3. Chrome拡張機能として読み込み
1. Chrome で `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をON
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `salesbot` フォルダーを選択

### 4. 初期設定
1. 拡張機能アイコンをクリックしてログイン画面を開く
2. Supabaseアカウントでログイン
3. プロファイル設定で営業情報を入力
4. URLリストを登録して実行開始

## 🎮 使用方法

### 基本的な操作フロー

1. **ログイン認証**
   ```
   拡張アイコンクリック → ログイン画面 → 認証情報入力
   ```

2. **プロファイル設定**
   ```
   ダッシュボード → プロファイル管理 → 新規作成/編集
   ```

3. **URL登録・実行**
   ```
   URL管理 → URLリスト入力 → 実行ボタン → 進捗監視
   ```

4. **結果確認**
   ```
   実行結果 → 統計表示 → CSV出力 → 詳細分析
   ```

## ⚙️ プロファイル設定

営業パターンに応じて複数のプロファイルを作成・管理できます：

### 基本情報
- **プロファイル名**: 識別用タイトル（例：IT企業向け、製造業向け）
- **会社情報**: 会社名、部署、役職、業界、従業員数
- **連絡先**: URL、メールアドレス、電話番号、FAX
- **住所**: 郵便番号、都道府県、市区町村、番地

### 営業メッセージ
- **件名**: 問い合わせ件名テンプレート
- **本文**: 営業メッセージ（HTMLタグ対応）
- **動的パラメータ**: `[param1]`〜`[param5]` による個別カスタマイズ
- **タグ機能**: URL別の追加パラメータ設定

### パラメータ例
```
件名: [param1]様向けDXソリューションのご提案
本文: [param2]の課題解決に向けて、弊社の[param3]をご提案させていただきます。
URL: https://example.com,[param1],[param2],[param3]
```

## 🎛️ ダッシュボード機能

### 📊 リアルタイム監視
- **進捗表示**: 処理済み/総数、成功率、現在処理中URL
- **統計情報**: 総送信数、成功数、失敗数、処理時間
- **ライブログ**: リアルタイム処理状況とエラー詳細

### 📈 結果管理
- **履歴一覧**: 過去の実行結果を時系列表示
- **詳細分析**: URL別の送信結果、失敗理由、コンタクト先
- **データ出力**: CSV/Excel形式でのエクスポート機能
- **編集機能**: タイトル変更、個別削除、一括削除

### ⚡ 実行制御
- **開始/停止**: 処理の即座開始・安全な停止
- **バッチ制御**: 100件単位での処理とサーバー負荷分散
- **時間制限**: 指定時間帯での実行制御

## 🔄 処理フロー詳細

### 1. 初期化・検証フェーズ
```
ライセンス確認 → 時間制限チェック → URLリスト検証 → 除外ドメイン適用
```

### 2. バッチ処理フェーズ
```
100件単位分割 → URL順次処理 → 30秒間隔休憩 → 次バッチ
```

### 3. 個別URL処理フェーズ
```
ページ移動 → フォーム探索 → リンク追跡 → 自動入力 → 送信実行 → 確認処理
```

### 4. 結果保存フェーズ
```
処理結果記録 → 統計更新 → 重複リスト更新 → ダッシュボード反映
```

## 🧩 技術アーキテクチャ

### コンポーネント構成
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ユーザーUI    │    │  バックグラウンド │    │   コンテンツ    │
│   (main.html)   │◄──►│  (background.js) │◄──►│  (explore/send) │
│                 │    │                 │    │                 │
│ ・ダッシュボード │    │ ・バッチ制御     │    │ ・フォーム探索   │
│ ・設定画面      │    │ ・ライセンス     │    │ ・自動入力      │
│ ・結果表示      │    │ ・進捗管理      │    │ ・送信確認      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                         │                         │
         ▼                         ▼                         ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    IndexedDB    │    │     Supabase    │    │   Chrome APIs   │
│   (exdb.js)     │    │                 │    │                 │
│ ・URL履歴       │    │ ・ユーザー認証   │    │ ・タブ制御      │
│ ・送信結果      │    │ ・デバイス管理   │    │ ・ストレージ     │
│ ・プロファイル   │    │ ・ライセンス     │    │ ・メッセージング │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### データフロー
```
URL入力 → バリデーション → バッチ分割 → 並列処理 → 結果集約 → 表示更新
```

## 🛡️ セキュリティ・注意事項

### ⚠️ 法的・倫理的な注意点
- **利用規約の遵守**: 送信先サイトの利用規約を必ず確認してください
- **営業許可の確認**: 無許可営業が禁止されている業界・地域では使用を控えてください  
- **個人情報保護**: 送信する個人情報の取り扱いには十分注意してください
- **送信頻度の調整**: 過度な送信はサーバー負荷やスパム判定の原因となります

### 🔒 技術的なセキュリティ
- **認証情報の管理**: Supabaseの認証キーは環境変数で管理してください
- **デバイス制限**: 不正アクセス防止のため最大5台までのデバイス制限を活用
- **データ暗号化**: 機密情報はSupabaseで暗号化して保存されます
- **ローカルデータ**: IndexedDBのデータは定期的にバックアップしてください

### 🚨 技術的制限事項
- **reCAPTCHA**: 完全自動化は困難、手動対応が必要な場合があります
- **JavaScript必須サイト**: 動的に生成されるフォームには対応できない場合があります
- **CSRF保護**: トークンが必要なサイトでは送信に失敗する可能性があります
- **ブラウザ制限**: Chrome以外のブラウザでは動作しません

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 🚫 認証エラー
```
エラー: Invalid login credentials
解決: Supabaseの認証情報、デバイス数制限を確認
```

#### ⏱️ 処理タイムアウト
```
エラー: 処理タイムアウト（90秒経過）
解決: 時間制限設定の確認、ネットワーク状況の改善
```

#### 📝 フォーム検出失敗
```
エラー: 問い合わせフォームが見つかりませんでした
解決: 除外ドメインの確認、手動でフォーム存在確認
```

#### 🔄 重複送信
```
エラー: 重複送信のため送信しない
解決: 重複送信防止設定の確認、送信履歴のクリア
```

### 🛠️ デバッグ情報
Chrome DevToolsのConsoleタブで詳細なログを確認できます：
```javascript
// 実行ログの確認
chrome.storage.local.get(['batchProgress'], console.log);

// 送信履歴の確認  
const db = new ExDB();
db.getAllTodos().then(console.log);
```

## 📊 パフォーマンス最適化

### ⚡ 推奨設定
- **バッチサイズ**: 100件（デフォルト、変更非推奨）
- **バッチ間隔**: 30秒（サーバー負荷軽減のため）
- **タイムアウト**: 90秒（複雑なフォームに対応）
- **除外ドメイン**: 応答速度の遅いサイトを事前除外

### 📈 効率化のコツ
- **URL事前検証**: 無効URLの事前除去で処理時間短縮
- **プロファイル最適化**: 簡潔なメッセージで送信成功率向上
- **時間帯調整**: アクセス集中時間を避けた実行
- **定期メンテナンス**: 送信履歴の定期クリアでパフォーマンス維持

## 🤝 開発・貢献ガイド

### 開発環境のセットアップ
```bash
# プロジェクトクローン
git clone https://github.com/yourname/sales-bot.git
cd sales-bot

# 開発用ブランチ作成
git checkout -b feature/your-feature-name

# テスト環境での確認
chrome://extensions/ → 開発者モード → 拡張機能読み込み
```

### コントリビューション手順
1. **Issue作成**: バグ報告・機能要望をGitHub Issuesで報告
2. **フォーク**: リポジトリをフォークして作業ブランチを作成
3. **実装**: コーディング規約に従って実装・テスト
4. **プルリクエスト**: 詳細な説明とテスト結果を添えて提出
5. **レビュー**: コードレビューを経てメインブランチにマージ

### 📝 コーディング規約
- **JavaScript**: ES2020+、非同期処理はasync/await推奨
- **コメント**: 日本語OK、重要な処理には必ず説明を追加
- **エラーハンドリング**: try-catch文の適切な使用
- **テスト**: 新機能には対応するテストケースを作成

## 📄 ライセンス・免責事項

### MIT License
このソフトウェアはMITライセンスの下で提供されています。
詳細は [LICENSE](LICENSE) ファイルを参照してください。

### 免責事項
- 本ツールの使用により生じた一切の損害について、開発者は責任を負いません
- 法的問題が発生した場合は、使用者の自己責任となります
- 営業活動における成果は保証されません

---

## 📞 サポート・お問い合わせ

- **バグ報告**: [GitHub Issues](https://github.com/yourname/sales-bot/issues)
- **機能要望**: [GitHub Discussions](https://github.com/yourname/sales-bot/discussions)
- **ドキュメント**: [Wiki](https://github.com/yourname/sales-bot/wiki)

---

*このREADMEは定期的に更新されています。最新情報は[リリースページ](https://github.com/yourname/sales-bot/releases)をご確認ください。*
