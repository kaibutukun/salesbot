# 🚀 Sales Bot - 自動お問い合わせ送信ツール

[![Chrome Extension](https://img.shields.io/badge/Chrome-Extension-blue.svg)](https://chrome.google.com/webstore)
[![Manifest V3](https://img.shields.io/badge/Manifest-V3-green.svg)](https://developer.chrome.com/docs/extensions/mv3/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Version](https://img.shields.io/badge/Version-1.0-brightgreen.svg)]()

大量のWebサイトに対して自動的にお問い合わせフォームを探索・入力・送信し、営業活動を劇的に効率化するChrome拡張機能です。

---

## 📋 目次

- [システム概要](#-システム概要)
- [主要機能](#-主要機能)
- [ディレクトリ構造](#-ディレクトリ構造)
- [システム要件](#-システム要件)
- [インストール手順](#️-インストール手順)
- [使用方法](#-使用方法)
- [技術アーキテクチャ](#-技術アーキテクチャ)
- [処理フロー](#-処理フロー)
- [セキュリティ・注意事項](#️-セキュリティ注意事項)
- [トラブルシューティング](#-トラブルシューティング)
- [開発・貢献ガイド](#-開発貢献ガイド)
- [ライセンス](#-ライセンス)

---

## ✨ システム概要

**Sales Bot**は、営業担当者が手動で行っていたお問い合わせフォームへの入力・送信作業を完全自動化するChrome拡張機能です。URLリストを読み込むだけで、以下の処理を自動実行します：

### 🎯 **核心機能**
1. **自動フォーム探索** - Webページ上のtextareaやコンタクトリンクを検出
2. **インテリジェント入力** - プロファイル設定に基づいてフォームを自動入力
3. **送信確認処理** - 確認ページでの最終送信まで自動化
4. **結果追跡** - 成功・失敗・重複を詳細に記録・分析

### 💡 **技術的特徴**
- **Manifest V3**対応の最新Chrome拡張機能
- **Supabase**による認証・ライセンス管理
- **IndexedDB**による高速ローカルデータ処理
- **モジュラー設計**による保守性の高いアーキテクチャ

---

## 🚀 主要機能

### 🔍 **高度な自動探索機能**
- **スマートフォーム検出**: textarea、input、select要素の自動識別
- **iframe対応**: クロスドメインiframe内のフォームも探索
- **コンタクトリンク追跡**: 問い合わせページへの自動遷移
- **除外ドメイン機能**: 特定ドメインの自動スキップ
- **営業お断り文言検出**: 自動的に営業拒否サイトを回避

### 🎯 **インテリジェント送信システム**
- **バッチ処理**: 100件ずつの効率的な処理（サーバー負荷軽減）
- **自動間隔調整**: 30秒間隔でのバッチ実行
- **重複送信防止**: 既送信先の自動スキップ機能
- **reCAPTCHA対応**: 最大40秒の待機処理
- **エラー回復**: 自動リトライ機能

### 📊 **プロファイル・データ管理**
- **複数プロファイル**: 異なる営業パターンの保存・切替
- **動的パラメータ**: `[param1]`〜`[param5]`による柔軟なメッセージ生成
- **タグ機能**: URL毎の個別設定対応
- **テンプレート管理**: 会社情報、連絡先、メッセージの一元管理
- **履歴管理**: 詳細な送信結果と統計情報

### 🕒 **スケジュール・制限機能**
- **時間制限**: 指定時間帯での自動送信制限
- **曜日制限**: 特定曜日の送信禁止設定
- **処理監視**: リアルタイム進捗表示・停止機能
- **一時停止**: 処理の安全な一時停止・再開

### 🔐 **認証・セキュリティ**
- **Supabase認証**: 安全なユーザー管理システム
- **デバイス制限**: 最大5台までのアクセス制御
- **ライセンス管理**: 有効性チェック機能
- **データ暗号化**: 機密情報の安全な保存

---

## 📁 ディレクトリ構造

```
Sales_Bot/salesbot/
├── 📄 manifest.json                    # Chrome拡張機能マニフェスト
├── 📄 background.js                    # バックグラウンドスクリプト（メイン処理エンジン）
├── 📄 popup.html                       # ポップアップ画面（ログイン入口）
├── 📄 README.md                        # プロジェクト説明書
│
├── 📁 assets/                          # 静的リソース
│   ├── 📄 styles.css                   # メインCSSファイル（全画面共通）
│   └── 📁 icons/                       # アイコンファイル群
│       ├── 📄 dashboard.png            # ダッシュボードアイコン
│       ├── 📄 play.png                 # 実行ボタンアイコン
│       ├── 📄 profiles.png             # プロフィール管理アイコン
│       ├── 📄 refresh.png              # 更新アイコン
│       ├── 📄 result.png               # 結果表示アイコン
│       ├── 📄 settings.png             # 設定アイコン
│       ├── 📄 stop.png                 # 停止ボタンアイコン
│       ├── 📄 url-list.png             # URLリスト管理アイコン
│       ├── 📄 ポチレターアイコン16.png    # 拡張機能アイコン（16px）
│       ├── 📄 ポチレターアイコン48.png    # 拡張機能アイコン（48px）
│       └── 📄 ポチレターアイコン128.png   # 拡張機能アイコン（128px）
│
├── 📁 content-scripts/                 # コンテンツスクリプト（Webページ操作）
│   ├── 📄 confirm.js                   # 送信確認処理（確認ページでの最終送信）
│   ├── 📄 explore.js                   # フォーム探索処理（textarea・リンク検出）
│   ├── 📄 recheck.js                   # reCAPTCHA検出・待機処理
│   └── 📄 send.js                      # 自動入力・送信処理（フォーム入力実行）
│
├── 📁 modules/                         # 機能モジュール（UI制御・ビジネスロジック）
│   ├── 📄 dashboard.js                 # ダッシュボード管理（統計表示・進捗監視）
│   ├── 📄 profile-manager.js           # プロフィール管理（営業データ・テンプレート）
│   ├── 📄 progress-monitor.js          # 進捗監視（リアルタイム処理状況）
│   ├── 📄 results-manager.js           # 結果管理（履歴・統計・CSV出力）
│   ├── 📄 settings-manager.js          # 設定管理（時間制限・除外ドメイン）
│   └── 📄 url-manager.js               # URL管理（リスト登録・バリデーション）
│
├── 📁 services/                        # サービス層（外部連携・ビジネスロジック）
│   ├── 📄 auth.service.js              # 認証サービス（Supabase連携・ライセンス管理）
│   ├── 📄 batch.service.js             # バッチ処理サービス（実行制御・進捗管理）
│   ├── 📄 form.service.js              # フォームサービス（入力処理・バリデーション）
│   └── 📄 storage.service.js           # ストレージサービス（データ永続化・同期）
│
├── 📁 shared/                          # 共有モジュール（全体で使用する共通機能）
│   ├── 📄 config.js                    # 設定管理（アプリケーション設定・定数）
│   ├── 📄 constants.js                 # 定数定義（アクション名・タイムアウト値）
│   ├── 📄 database.js                  # データベース操作（ExDBクラス・IndexedDB管理）
│   └── 📄 utils.js                     # ユーティリティ（共通関数・ヘルパー）
│
├── 📁 supabase/                        # Supabase連携
│   └── 📄 supabase.js                  # Supabaseクライアント（認証・データベース接続）
│
└── 📁 ui/                              # UI層（ユーザーインターフェース）
    ├── 📄 done.html                    # 完了画面（処理完了・結果表示）
    ├── 📄 done.js                      # 完了画面JavaScript
    ├── 📄 error.html                   # エラー画面（エラー表示・復旧案内）
    ├── 📄 login.html                   # ログイン画面（認証・初期設定）
    ├── 📄 login.js                     # ログイン画面JavaScript
    ├── 📄 main.html                    # メイン画面（ダッシュボード・管理画面）
    ├── 📄 main.js                      # メイン画面JavaScript
    ├── 📄 process.html                 # 処理画面（進捗表示・リアルタイム監視）
    ├── 📄 process.js                   # 処理画面JavaScript
    ├── 📄 time_restricted.html         # 時間制限画面（制限時間帯の案内）
    └── 📄 time_restricted.js           # 時間制限画面JavaScript
```

### 📂 **ディレクトリ詳細説明**

#### **ルートファイル**
- `manifest.json`: Chrome拡張機能の設定ファイル（権限・アイコン・バックグラウンドスクリプト）
- `background.js`: Service Workerベースのメイン処理エンジン（バッチ制御・ライセンス管理）
- `popup.html`: 拡張機能アイコンクリック時のポップアップ（ログイン入口）

#### **assets/**: 静的リソース
- `styles.css`: 全画面共通のCSSスタイル（モダンUI・レスポンシブデザイン）
- `icons/`: UI用アイコンと拡張機能アイコン（PNG形式、複数サイズ対応）

#### **content-scripts/**: Webページ操作
- `explore.js`: フォーム・コンタクトリンクの自動探索
- `send.js`: フォームへの自動入力・送信実行
- `confirm.js`: 送信確認ページでの最終処理
- `recheck.js`: reCAPTCHA検出・待機処理

#### **modules/**: 機能モジュール
- ダッシュボード、プロフィール、進捗監視、結果管理、設定、URL管理の各機能モジュール
- UI制御とビジネスロジックを担当

#### **services/**: サービス層
- 外部システム連携（Supabase認証）とビジネスロジック（バッチ処理・フォーム処理）
- データ永続化・同期処理

#### **shared/**: 共有モジュール
- 全体で使用する共通機能（設定・定数・データベース・ユーティリティ）
- ExDBクラス（IndexedDB操作の抽象化）

#### **ui/**: ユーザーインターフェース
- 各画面のHTML・JavaScript（ログイン・メイン・処理・完了・エラー・時間制限）
- 画面遷移とユーザー操作処理

---

## 📦 システム要件

### **必須要件**
- **Google Chrome** 最新版（Manifest V3対応）
- **Chrome拡張機能の開発者モード** を有効化
- **インターネット接続**（認証・同期用）

### **推奨環境**
- **RAM**: 4GB以上
- **ストレージ**: 100MB以上の空き容量
- **ネットワーク**: 安定したインターネット接続

### **外部サービス**
- **Supabase プロジェクト**（認証・ライセンス管理用）
- **有効なライセンス**（最大5台のデバイス制限）

---

## 🛠️ インストール手順

### **1. プロジェクトの取得**
```bash
# リポジトリのクローン
git clone https://github.com/yourname/sales-bot.git
cd sales-bot/salesbot
```

### **2. Supabase設定**
以下のファイルでSupabase設定を更新してください：

**background.js** (3-6行目)
```javascript
const SUPABASE_CONFIG = {
    url: 'https://YOUR_PROJECT.supabase.co',
    anonKey: 'YOUR_ANON_KEY'
};
```

**ui/login.js** (7-10行目)
```javascript
const supabaseConfig = {
    url: 'https://YOUR_PROJECT.supabase.co',
    anonKey: 'YOUR_ANON_KEY'
};
```

### **3. Chrome拡張機能として読み込み**
1. Chrome で `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をON
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `salesbot` フォルダーを選択

### **4. 初期設定**
1. 拡張機能アイコンをクリックしてログイン画面を開く
2. Supabaseアカウントでログイン
3. プロフィール設定で営業情報を入力
4. URLリストを登録して実行開始

---

## 🎮 使用方法

### **基本的な操作フロー**

#### **1. ログイン認証**
```
拡張アイコンクリック → ログイン画面 → 認証情報入力 → メイン画面
```

#### **2. プロフィール設定**
```
ダッシュボード → プロファイル管理 → 新規作成/編集 → 営業情報入力
```

#### **3. URL登録・実行**
```
URL管理 → URLリスト入力 → 実行ボタン → 進捗監視 → 結果確認
```

#### **4. 結果分析**
```
実行結果 → 統計表示 → CSV出力 → 詳細分析 → 次回改善
```

### **⚙️ プロフィール設定**

営業パターンに応じて複数のプロフィールを作成・管理できます：

#### **基本情報**
- **プロフィール名**: 識別用タイトル（例：IT企業向け、製造業向け）
- **会社情報**: 会社名、部署、役職、業界、従業員数
- **連絡先**: URL、メールアドレス、電話番号、FAX
- **住所**: 郵便番号、都道府県、市区町村、番地

#### **営業メッセージ**
- **件名**: 問い合わせ件名テンプレート
- **本文**: 営業メッセージ（HTMLタグ対応）
- **動的パラメータ**: `[param1]`〜`[param5]` による個別カスタマイズ
- **タグ機能**: URL別の追加パラメータ設定

#### **パラメータ例**
```
件名: [param1]様向けDXソリューションのご提案
本文: [param2]の課題解決に向けて、弊社の[param3]をご提案させていただきます。

URLリスト形式:
https://example.com,[param1],[param2],[param3]
```

### **🎛️ ダッシュボード機能**

#### **📊 リアルタイム監視**
- **進捗表示**: 処理済み/総数、成功率、現在処理中URL
- **統計情報**: 総送信数、成功数、失敗数、処理時間
- **ライブログ**: リアルタイム処理状況とエラー詳細

#### **📈 結果管理**
- **履歴一覧**: 過去の実行結果を時系列表示
- **詳細分析**: URL別の送信結果、失敗理由、コンタクト先
- **データ出力**: CSV/Excel形式でのエクスポート機能
- **編集機能**: タイトル変更、個別削除、一括削除

#### **⚡ 実行制御**
- **開始/停止**: 処理の即座開始・安全な停止
- **バッチ制御**: 100件単位での処理とサーバー負荷分散
- **時間制限**: 指定時間帯での実行制御

---

## 🧩 技術アーキテクチャ

### **システム構成図**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ユーザーUI    │    │  バックグラウンド │    │   コンテンツ    │
│   (ui/*.html)   │◄──►│  (background.js) │◄──►│(content-scripts)│
│                 │    │                 │    │                 │
│ ・ダッシュボード │    │ ・バッチ制御     │    │ ・フォーム探索   │
│ ・設定画面      │    │ ・ライセンス     │    │ ・自動入力      │
│ ・結果表示      │    │ ・進捗管理      │    │ ・送信確認      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                         │                         │
         ▼                         ▼                         ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    IndexedDB    │    │     Supabase    │    │   Chrome APIs   │
│ (shared/database)│    │                 │    │                 │
│ ・URL履歴       │    │ ・ユーザー認証   │    │ ・タブ制御      │
│ ・送信結果      │    │ ・デバイス管理   │    │ ・ストレージ     │
│ ・プロファイル   │    │ ・ライセンス     │    │ ・メッセージング │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### **技術スタック**
- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6+)
- **Backend**: Chrome Extension Service Worker
- **Database**: IndexedDB (ローカル), Supabase (クラウド)
- **Authentication**: Supabase Auth
- **Architecture**: Modular ES6 Modules, Service-Oriented Design

### **データフロー**
```
URL入力 → バリデーション → バッチ分割 → 並列処理 → 結果集約 → 表示更新
```

---

## 🔄 処理フロー

### **1. 初期化・検証フェーズ**
```
ライセンス確認 → 時間制限チェック → URLリスト検証 → 除外ドメイン適用
```

### **2. バッチ処理フェーズ**
```
100件単位分割 → URL順次処理 → 30秒間隔休憩 → 次バッチ
```

### **3. 個別URL処理フェーズ**
```
ページ移動 → フォーム探索 → リンク追跡 → 自動入力 → 送信実行 → 確認処理
```

### **4. 結果保存フェーズ**
```
処理結果記録 → 統計更新 → 重複リスト更新 → ダッシュボード反映
```

### **📊 処理詳細**

#### **フォーム探索アルゴリズム**
1. **メインドキュメント**でtextarea要素を検索
2. **iframe内**でフォーム要素を検索（クロスドメイン対応）
3. **コンタクトリンク**を検索（URL・テキストベース）
4. **営業お断り文言**を検出して回避

#### **自動入力処理**
1. **プロフィールデータ**の取得・パラメータ置換
2. **フォーム要素**の識別・マッピング
3. **段階的入力**（基本情報→詳細情報→メッセージ）
4. **送信前確認**・最終チェック

---

## 🛡️ セキュリティ・注意事項

### **⚠️ 法的・倫理的な注意点**
- **利用規約の遵守**: 送信先サイトの利用規約を必ず確認してください
- **営業許可の確認**: 無許可営業が禁止されている業界・地域では使用を控えてください  
- **個人情報保護**: 送信する個人情報の取り扱いには十分注意してください
- **送信頻度の調整**: 過度な送信はサーバー負荷やスパム判定の原因となります

### **🔒 技術的なセキュリティ**
- **認証情報の管理**: Supabaseの認証キーは環境変数で管理してください
- **デバイス制限**: 不正アクセス防止のため最大5台までのデバイス制限を活用
- **データ暗号化**: 機密情報はSupabaseで暗号化して保存されます
- **ローカルデータ**: IndexedDBのデータは定期的にバックアップしてください

### **🚨 技術的制限事項**
- **reCAPTCHA**: 完全自動化は困難、手動対応が必要な場合があります
- **JavaScript必須サイト**: 動的に生成されるフォームには対応できない場合があります
- **CSRF保護**: トークンが必要なサイトでは送信に失敗する可能性があります
- **ブラウザ制限**: Chrome以外のブラウザでは動作しません

---

## 🔧 トラブルシューティング

### **よくある問題と解決方法**

#### **🚫 認証エラー**
```
エラー: Invalid login credentials
解決策:
1. Supabaseの認証情報を確認
2. デバイス数制限（5台まで）を確認
3. ライセンスの有効性を確認
```

#### **⏱️ 処理タイムアウト**
```
エラー: 処理タイムアウト（90秒経過）
解決策:
1. 時間制限設定を確認
2. ネットワーク状況を改善
3. 除外ドメインに追加
```

#### **📝 フォーム検出失敗**
```
エラー: 問い合わせフォームが見つかりませんでした
解決策:
1. 除外ドメインの確認
2. 手動でフォーム存在確認
3. iframe内フォームの可能性を確認
```

#### **🔄 重複送信**
```
エラー: 重複送信のため送信しない
解決策:
1. 重複送信防止設定の確認
2. 送信履歴のクリア
3. 新しいプロフィールで実行
```

### **🛠️ デバッグ情報**
Chrome DevToolsのConsoleタブで詳細なログを確認できます：
```javascript
// 実行ログの確認
chrome.storage.local.get(['batchProgress'], console.log);

// 送信履歴の確認  
const db = new ExDB();
db.getAllTodos().then(console.log);

// ライセンス状態の確認
chrome.storage.local.get(['licenseStatus'], console.log);
```

---

## 📊 パフォーマンス最適化

### **⚡ 推奨設定**
- **バッチサイズ**: 100件（デフォルト、変更非推奨）
- **バッチ間隔**: 30秒（サーバー負荷軽減のため）
- **タイムアウト**: 90秒（複雑なフォームに対応）
- **除外ドメイン**: 応答速度の遅いサイトを事前除外

### **📈 効率化のコツ**
- **URL事前検証**: 無効URLの事前除去で処理時間短縮
- **プロファイル最適化**: 簡潔なメッセージで送信成功率向上
- **時間帯調整**: アクセス集中時間を避けた実行
- **定期メンテナンス**: 送信履歴の定期クリアでパフォーマンス維持

---

## 🤝 開発・貢献ガイド

### **開発環境のセットアップ**
```bash
# プロジェクトクローン
git clone https://github.com/yourname/sales-bot.git
cd sales-bot

# 開発用ブランチ作成
git checkout -b feature/your-feature-name

# テスト環境での確認
chrome://extensions/ → 開発者モード → 拡張機能読み込み
```

### **コントリビューション手順**
1. **Issue作成**: バグ報告・機能要望をGitHub Issuesで報告
2. **フォーク**: リポジトリをフォークして作業ブランチを作成
3. **実装**: コーディング規約に従って実装・テスト
4. **プルリクエスト**: 詳細な説明とテスト結果を添えて提出
5. **レビュー**: コードレビューを経てメインブランチにマージ

### **📝 コーディング規約**
- **JavaScript**: ES2020+、非同期処理はasync/await推奨
- **モジュール**: ESモジュール形式でインポート/エクスポート
- **コメント**: 日本語OK、重要な処理には必ず説明を追加
- **エラーハンドリング**: try-catch文の適切な使用
- **テスト**: 新機能には対応するテストケースを作成

### **📂 ファイル命名規則**
- **JavaScript**: kebab-case（例：profile-manager.js）
- **HTML**: kebab-case（例：time-restricted.html）
- **CSS**: kebab-case（例：styles.css）
- **画像**: descriptive-name（例：dashboard.png）

---

## 📄 ライセンス・免責事項

### **MIT License**
このソフトウェアはMITライセンスの下で提供されています。
詳細は [LICENSE](LICENSE) ファイルを参照してください。

### **免責事項**
- 本ツールの使用により生じた一切の損害について、開発者は責任を負いません
- 法的問題が発生した場合は、使用者の自己責任となります
- 営業活動における成果は保証されません
- 送信先サイトの利用規約に違反しないよう十分注意してください

---

## 📞 サポート・お問い合わせ

### **サポートチャンネル**
- **バグ報告**: [GitHub Issues](https://github.com/yourname/sales-bot/issues)
- **機能要望**: [GitHub Discussions](https://github.com/yourname/sales-bot/discussions)
- **ドキュメント**: [Wiki](https://github.com/yourname/sales-bot/wiki)
- **メール**: support@your-domain.com

### **開発チーム**
- **プロジェクトリーダー**: Your Name
- **バックエンド開発**: Backend Developer
- **フロントエンド開発**: Frontend Developer
- **QA エンジニア**: QA Engineer

---

## 📈 ロードマップ

### **v1.1 (次期バージョン)**
- [ ] 多言語対応（英語・中国語）
- [ ] API連携機能の拡張
- [ ] AIによる自動メッセージ最適化
- [ ] モバイル対応（Chrome Mobile）

### **v1.2 (中期)**
- [ ] 他ブラウザ対応（Firefox、Edge）
- [ ] 高度な分析機能
- [ ] チーム機能・複数ユーザー対応
- [ ] Webhook連携

### **v2.0 (長期)**
- [ ] 完全AI自動化
- [ ] SaaS版リリース
- [ ] エンタープライズ機能
- [ ] グローバル展開

---

## 🙏 謝辞

このプロジェクトは以下の技術・サービスを活用しています：

- **Google Chrome Extensions API** - 拡張機能の基盤
- **Supabase** - 認証・データベースサービス
- **IndexedDB** - ローカルデータ永続化
- **Chrome DevTools** - 開発・デバッグツール

また、オープンソースコミュニティの皆様のご協力に深く感謝いたします。

---

*このREADMEは定期的に更新されています。最新情報は[リリースページ](https://github.com/yourname/sales-bot/releases)をご確認ください。*

**最終更新**: 2024年12月
**バージョン**: 1.0
**作成者**: Sales Bot Development Team